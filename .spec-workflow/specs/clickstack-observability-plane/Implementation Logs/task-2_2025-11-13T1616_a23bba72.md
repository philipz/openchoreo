# Implementation Log: Task 2

**Summary:** Enabled the observer API to select a ClickStack storage backend with dual-read drift detection, expanded config for telemetry/hyperdx, and added a signed HyperDX link endpoint.

**Timestamp:** 2025-11-13T16:16:42.023Z
**Log ID:** a23bba72-699d-45b9-9956-3c73a90efd55

---

## Statistics

- **Lines Added:** +768
- **Lines Removed:** -123
- **Files Changed:** 7
- **Net Change:** 645

## Files Modified
- cmd/observer/main.go
- internal/observer/config/config.go
- internal/observer/config/config_test.go
- internal/observer/handlers/handlers.go
- internal/observer/service/service.go
- internal/observer/service/service_test.go

## Files Created
- internal/observer/service/hyperdx.go

---

## Artifacts

### API Endpoints

#### POST /api/hyperdx/link
- **Purpose:** Returns a signed HyperDX dashboard URL for embedding the ClickStack UI.
- **Location:** internal/observer/handlers/handlers.go:383
- **Request Format:** JSON body: { path: string, params?: Record<string,string> }
- **Response Format:** 200 OK { url: string }; 400/500 on validation or signing errors.

### Functions

#### GenerateHyperDXLink
- **Purpose:** Creates a signed HyperDX URL when signing is configured, otherwise errors.
- **Location:** internal/observer/service/service.go:153
- **Signature:** (path string, params map[string]string) (string, error)
- **Exported:** Yes

#### buildComponentLogQuery
- **Purpose:** Converts handler Component log params into ClickStack-friendly query filters.
- **Location:** internal/observer/service/service.go:478
- **Signature:** (params opensearch.ComponentQueryParams) (query.ComponentLogQuery, error)
- **Exported:** No

#### newDualSampler
- **Purpose:** Configures probabilistic dual-read sampling for ClickStack/OpenSearch drift detection.
- **Location:** internal/observer/service/service.go:430
- **Signature:** (cfg config.TelemetryConfig) *dualSampler
- **Exported:** No

### Classes

#### HyperDXSigner
- **Purpose:** Generates HMAC-signed HyperDX URLs with expiry handling for embedding dashboards.
- **Location:** internal/observer/service/hyperdx.go:16
- **Methods:** Generate
- **Exported:** No

#### LoggingService
- **Purpose:** Now orchestrates ClickStack or OpenSearch storage providers, dual-read sampling, and HyperDX link generation.
- **Location:** internal/observer/service/service.go
- **Methods:** GetComponentLogs, GetProjectLogs, GetGatewayLogs, GetOrganizationLogs, GetComponentTraces, HealthCheck, GenerateHyperDXLink
- **Exported:** Yes

### Integrations

#### Integration
- **Description:** Observer binary chooses ClickStack or OpenSearch storage at startup and exposes signed HyperDX links for Backstage/CLI consumers.
- **Frontend Component:** cmd/observer/main.go
- **Backend Endpoint:** POST /api/hyperdx/link
- **Data Flow:** Configuration load → ClickStack provider optional init → Handler delegates to LoggingService → Link response consumed by portals for embedding HyperDX dashboards.

